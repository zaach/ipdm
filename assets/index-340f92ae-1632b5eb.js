import{c as Ns,l as ft,n as it,s as Fs,A as yt,T as Vs,C as Y,E as qs,a as ct,g as Gs,m as ut}from"./index-733f4847.js";var tt={exports:{}},Mt=a=>{if(a[Symbol.asyncIterator])return a;if(a.getReader)return async function*(){const s=a.getReader();try{for(;;){const{done:i,value:h}=await s.read();if(i)return;yield h}}finally{s.releaseLock()}}();throw new Error("unknown stream")},zs=function(a){if(a){if(typeof a[Symbol.iterator]=="function")return a[Symbol.iterator]();if(typeof a[Symbol.asyncIterator]=="function")return a[Symbol.asyncIterator]();if(typeof a.next=="function")return a}throw new Error("argument is not an iterator or iterable")};const Zs=zs;var Ut=a=>async s=>{s=Zs(s);const i=M=>{typeof M.return=="function"&&M.return()};let h=null,c=null;const o=M=>{h=M,c&&c(M),i(s)};let l=null,v=!1;const y=()=>{v=!0,l&&l()};let b=null,I=!1;const f=()=>{I=!0,b&&b()};let A=null;const T=()=>{A&&A()},w=()=>new Promise((M,z)=>{l=A=M,c=z,a.once("drain",T)}),g=()=>(i(s),new Promise((M,z)=>{if(v||I||h)return M();b=l=M,c=z})),L=()=>{a.removeListener("error",o),a.removeListener("close",y),a.removeListener("finish",f),a.removeListener("drain",T)};a.once("error",o),a.once("close",y),a.once("finish",f);try{for await(const M of s){if(!a.writable||a.destroyed||h)break;a.write(M)===!1&&await w()}}catch(M){h||a.destroy(),h=M}try{if(a.writable&&a.end(),await g(),h)throw h}finally{L()}};const Us=Ut,Hs=Mt;var Ht=a=>({sink:Us(a),source:Hs(a)});const Ks=Ht;var Ws=a=>async function*(s){const i=Ks(a);let h;if(i.sink(s).catch(c=>{h=c}),yield*i.source,h)throw h};tt.exports=Mt;tt.exports.source=Mt;tt.exports.sink=Ut;tt.exports.transform=Ws;tt.exports.duplex=Ht;var Js=tt.exports;const Qs=Gs(Js);function Kt(a){return this.subnetMask<a.subnetMask?!1:this.mask(a.subnetMask)===a.mask()}function Wt(a){return function(){return this.addressMinusSuffix!==this.correctForm()?!1:this.subnetMask===a&&!this.parsedSubnet?!0:this.parsedSubnet===String(this.subnetMask)}}const X=32,Ct=4,lt=/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/g,Ot=/\/\d{1,2}$/;class G extends Error{constructor(s,i){super(s),this.name="AddressError",i!==null&&(this.parseMessage=i)}}var Jt={exports:{}};(function(a,s){(function(){var i,h=0xdeadbeefcafe,c=(h&16777215)==15715070;function o(t,e,r){t!=null&&(typeof t=="number"?this.fromNumber(t,e,r):e==null&&typeof t!="string"?this.fromString(t,256):this.fromString(t,e))}function l(){return new o(null)}function v(t,e,r,n,p,u){for(;--u>=0;){var d=e*this[t++]+r[n]+p;p=Math.floor(d/67108864),r[n++]=d&67108863}return p}function y(t,e,r,n,p,u){for(var d=e&32767,m=e>>15;--u>=0;){var B=this[t]&32767,D=this[t++]>>15,j=m*B+D*d;B=d*B+((j&32767)<<15)+r[n]+(p&1073741823),p=(B>>>30)+(j>>>15)+m*D+(p>>>30),r[n++]=B&1073741823}return p}function b(t,e,r,n,p,u){for(var d=e&16383,m=e>>14;--u>=0;){var B=this[t]&16383,D=this[t++]>>14,j=m*B+D*d;B=d*B+((j&16383)<<14)+r[n]+p,p=(B>>28)+(j>>14)+m*D,r[n++]=B&268435455}return p}var I=typeof navigator<"u";I&&c&&navigator.appName=="Microsoft Internet Explorer"?(o.prototype.am=y,i=30):I&&c&&navigator.appName!="Netscape"?(o.prototype.am=v,i=26):(o.prototype.am=b,i=28),o.prototype.DB=i,o.prototype.DM=(1<<i)-1,o.prototype.DV=1<<i;var f=52;o.prototype.FV=Math.pow(2,f),o.prototype.F1=f-i,o.prototype.F2=2*i-f;var A="0123456789abcdefghijklmnopqrstuvwxyz",T=new Array,w,g;for(w="0".charCodeAt(0),g=0;g<=9;++g)T[w++]=g;for(w="a".charCodeAt(0),g=10;g<36;++g)T[w++]=g;for(w="A".charCodeAt(0),g=10;g<36;++g)T[w++]=g;function L(t){return A.charAt(t)}function M(t,e){var r=T[t.charCodeAt(e)];return r??-1}function z(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s}function et(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0}function _(t){var e=l();return e.fromInt(t),e}function Xt(t,e){var r;if(e==16)r=4;else if(e==8)r=3;else if(e==256)r=8;else if(e==2)r=1;else if(e==32)r=5;else if(e==4)r=2;else{this.fromRadix(t,e);return}this.t=0,this.s=0;for(var n=t.length,p=!1,u=0;--n>=0;){var d=r==8?t[n]&255:M(t,n);if(d<0){t.charAt(n)=="-"&&(p=!0);continue}p=!1,u==0?this[this.t++]=d:u+r>this.DB?(this[this.t-1]|=(d&(1<<this.DB-u)-1)<<u,this[this.t++]=d>>this.DB-u):this[this.t-1]|=d<<u,u+=r,u>=this.DB&&(u-=this.DB)}r==8&&t[0]&128&&(this.s=-1,u>0&&(this[this.t-1]|=(1<<this.DB-u)-1<<u)),this.clamp(),p&&o.ZERO.subTo(this,this)}function te(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t}function ee(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(t==16)e=4;else if(t==8)e=3;else if(t==2)e=1;else if(t==32)e=5;else if(t==4)e=2;else return this.toRadix(t);var r=(1<<e)-1,n,p=!1,u="",d=this.t,m=this.DB-d*this.DB%e;if(d-- >0)for(m<this.DB&&(n=this[d]>>m)>0&&(p=!0,u=L(n));d>=0;)m<e?(n=(this[d]&(1<<m)-1)<<e-m,n|=this[--d]>>(m+=this.DB-e)):(n=this[d]>>(m-=e)&r,m<=0&&(m+=this.DB,--d)),n>0&&(p=!0),p&&(u+=L(n));return p?u:"0"}function se(){var t=l();return o.ZERO.subTo(this,t),t}function re(){return this.s<0?this.negate():this}function ie(t){var e=this.s-t.s;if(e!=0)return e;var r=this.t;if(e=r-t.t,e!=0)return this.s<0?-e:e;for(;--r>=0;)if((e=this[r]-t[r])!=0)return e;return 0}function nt(t){var e=1,r;return(r=t>>>16)!=0&&(t=r,e+=16),(r=t>>8)!=0&&(t=r,e+=8),(r=t>>4)!=0&&(t=r,e+=4),(r=t>>2)!=0&&(t=r,e+=2),(r=t>>1)!=0&&(t=r,e+=1),e}function ne(){return this.t<=0?0:this.DB*(this.t-1)+nt(this[this.t-1]^this.s&this.DM)}function oe(t,e){var r;for(r=this.t-1;r>=0;--r)e[r+t]=this[r];for(r=t-1;r>=0;--r)e[r]=0;e.t=this.t+t,e.s=this.s}function ae(t,e){for(var r=t;r<this.t;++r)e[r-t]=this[r];e.t=Math.max(this.t-t,0),e.s=this.s}function he(t,e){var r=t%this.DB,n=this.DB-r,p=(1<<n)-1,u=Math.floor(t/this.DB),d=this.s<<r&this.DM,m;for(m=this.t-1;m>=0;--m)e[m+u+1]=this[m]>>n|d,d=(this[m]&p)<<r;for(m=u-1;m>=0;--m)e[m]=0;e[u]=d,e.t=this.t+u+1,e.s=this.s,e.clamp()}function ce(t,e){e.s=this.s;var r=Math.floor(t/this.DB);if(r>=this.t){e.t=0;return}var n=t%this.DB,p=this.DB-n,u=(1<<n)-1;e[0]=this[r]>>n;for(var d=r+1;d<this.t;++d)e[d-r-1]|=(this[d]&u)<<p,e[d-r]=this[d]>>n;n>0&&(e[this.t-r-1]|=(this.s&u)<<p),e.t=this.t-r,e.clamp()}function pe(t,e){for(var r=0,n=0,p=Math.min(t.t,this.t);r<p;)n+=this[r]-t[r],e[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;r<this.t;)n+=this[r],e[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n-=t[r],e[r++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=n<0?-1:0,n<-1?e[r++]=this.DV+n:n>0&&(e[r++]=n),e.t=r,e.clamp()}function ue(t,e){var r=this.abs(),n=t.abs(),p=r.t;for(e.t=p+n.t;--p>=0;)e[p]=0;for(p=0;p<n.t;++p)e[p+r.t]=r.am(0,n[p],e,p,0,r.t);e.s=0,e.clamp(),this.s!=t.s&&o.ZERO.subTo(e,e)}function le(t){for(var e=this.abs(),r=t.t=2*e.t;--r>=0;)t[r]=0;for(r=0;r<e.t-1;++r){var n=e.am(r,e[r],t,2*r,0,1);(t[r+e.t]+=e.am(r+1,2*e[r],t,2*r+1,n,e.t-r-1))>=e.DV&&(t[r+e.t]-=e.DV,t[r+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(r,e[r],t,2*r,0,1)),t.s=0,t.clamp()}function fe(t,e,r){var n=t.abs();if(!(n.t<=0)){var p=this.abs();if(p.t<n.t){e?.fromInt(0),r!=null&&this.copyTo(r);return}r==null&&(r=l());var u=l(),d=this.s,m=t.s,B=this.DB-nt(n[n.t-1]);B>0?(n.lShiftTo(B,u),p.lShiftTo(B,r)):(n.copyTo(u),p.copyTo(r));var D=u.t,j=u[D-1];if(j!=0){var O=j*(1<<this.F1)+(D>1?u[D-2]>>this.F2:0),Z=this.FV/O,at=(1<<this.F1)/O,F=1<<this.F2,V=r.t,ht=V-D,K=e??l();for(u.dlShiftTo(ht,K),r.compareTo(K)>=0&&(r[r.t++]=1,r.subTo(K,r)),o.ONE.dlShiftTo(D,K),K.subTo(u,u);u.t<D;)u[u.t++]=0;for(;--ht>=0;){var vt=r[--V]==j?this.DM:Math.floor(r[V]*Z+(r[V-1]+F)*at);if((r[V]+=u.am(0,vt,r,ht,0,D))<vt)for(u.dlShiftTo(ht,K),r.subTo(K,r);r[V]<--vt;)r.subTo(K,r)}e!=null&&(r.drShiftTo(D,e),d!=m&&o.ZERO.subTo(e,e)),r.t=D,r.clamp(),B>0&&r.rShiftTo(B,r),d<0&&o.ZERO.subTo(r,r)}}}function de(t){var e=l();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(o.ZERO)>0&&t.subTo(e,e),e}function W(t){this.m=t}function me(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function ge(t){return t}function ve(t){t.divRemTo(this.m,null,t)}function ye(t,e,r){t.multiplyTo(e,r),this.reduce(r)}function be(t,e){t.squareTo(e),this.reduce(e)}W.prototype.convert=me,W.prototype.revert=ge,W.prototype.reduce=ve,W.prototype.mulTo=ye,W.prototype.sqrTo=be;function we(){if(this.t<1)return 0;var t=this[0];if(!(t&1))return 0;var e=t&3;return e=e*(2-(t&15)*e)&15,e=e*(2-(t&255)*e)&255,e=e*(2-((t&65535)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function J(t){this.m=t,this.mp=t.invDigit(),this.mpl=this.mp&32767,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function Te(t){var e=l();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(o.ZERO)>0&&this.m.subTo(e,e),e}function Se(t){var e=l();return t.copyTo(e),this.reduce(e),e}function Ae(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var r=t[e]&32767,n=r*this.mpl+((r*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(r=e+this.m.t,t[r]+=this.m.am(0,n,t,e,0,this.m.t);t[r]>=t.DV;)t[r]-=t.DV,t[++r]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function Be(t,e){t.squareTo(e),this.reduce(e)}function Me(t,e,r){t.multiplyTo(e,r),this.reduce(r)}J.prototype.convert=Te,J.prototype.revert=Se,J.prototype.reduce=Ae,J.prototype.mulTo=Me,J.prototype.sqrTo=Be;function Ee(){return(this.t>0?this[0]&1:this.s)==0}function Ie(t,e){if(t>4294967295||t<1)return o.ONE;var r=l(),n=l(),p=e.convert(this),u=nt(t)-1;for(p.copyTo(r);--u>=0;)if(e.sqrTo(r,n),(t&1<<u)>0)e.mulTo(n,p,r);else{var d=r;r=n,n=d}return e.revert(r)}function ke(t,e){var r;return t<256||e.isEven()?r=new W(e):r=new J(e),this.exp(t,r)}o.prototype.copyTo=z,o.prototype.fromInt=et,o.prototype.fromString=Xt,o.prototype.clamp=te,o.prototype.dlShiftTo=oe,o.prototype.drShiftTo=ae,o.prototype.lShiftTo=he,o.prototype.rShiftTo=ce,o.prototype.subTo=pe,o.prototype.multiplyTo=ue,o.prototype.squareTo=le,o.prototype.divRemTo=fe,o.prototype.invDigit=we,o.prototype.isEven=Ee,o.prototype.exp=Ie,o.prototype.toString=ee,o.prototype.negate=se,o.prototype.abs=re,o.prototype.compareTo=ie,o.prototype.bitLength=ne,o.prototype.mod=de,o.prototype.modPowInt=ke,o.ZERO=_(0),o.ONE=_(1);function xe(){var t=l();return this.copyTo(t),t}function De(){if(this.s<0){if(this.t==1)return this[0]-this.DV;if(this.t==0)return-1}else{if(this.t==1)return this[0];if(this.t==0)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]}function Re(){return this.t==0?this.s:this[0]<<24>>24}function _e(){return this.t==0?this.s:this[0]<<16>>16}function $e(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function Ce(){return this.s<0?-1:this.t<=0||this.t==1&&this[0]<=0?0:1}function Oe(t){if(t==null&&(t=10),this.signum()==0||t<2||t>36)return"0";var e=this.chunkSize(t),r=Math.pow(t,e),n=_(r),p=l(),u=l(),d="";for(this.divRemTo(n,p,u);p.signum()>0;)d=(r+u.intValue()).toString(t).substr(1)+d,p.divRemTo(n,p,u);return u.intValue().toString(t)+d}function Pe(t,e){this.fromInt(0),e==null&&(e=10);for(var r=this.chunkSize(e),n=Math.pow(e,r),p=!1,u=0,d=0,m=0;m<t.length;++m){var B=M(t,m);if(B<0){t.charAt(m)=="-"&&this.signum()==0&&(p=!0);continue}d=e*d+B,++u>=r&&(this.dMultiply(n),this.dAddOffset(d,0),u=0,d=0)}u>0&&(this.dMultiply(Math.pow(e,u)),this.dAddOffset(d,0)),p&&o.ZERO.subTo(this,this)}function Le(t,e,r){if(typeof e=="number")if(t<2)this.fromInt(1);else for(this.fromNumber(t,r),this.testBit(t-1)||this.bitwiseTo(o.ONE.shiftLeft(t-1),dt,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(o.ONE.shiftLeft(t-1),this);else{var n=new Array,p=t&7;n.length=(t>>3)+1,e.nextBytes(n),p>0?n[0]&=(1<<p)-1:n[0]=0,this.fromString(n,256)}}function je(){var t=this.t,e=new Array;e[0]=this.s;var r=this.DB-t*this.DB%8,n,p=0;if(t-- >0)for(r<this.DB&&(n=this[t]>>r)!=(this.s&this.DM)>>r&&(e[p++]=n|this.s<<this.DB-r);t>=0;)r<8?(n=(this[t]&(1<<r)-1)<<8-r,n|=this[--t]>>(r+=this.DB-8)):(n=this[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),n&128&&(n|=-256),p==0&&(this.s&128)!=(n&128)&&++p,(p>0||n!=this.s)&&(e[p++]=n);return e}function Ne(t){return this.compareTo(t)==0}function Fe(t){return this.compareTo(t)<0?this:t}function Ve(t){return this.compareTo(t)>0?this:t}function qe(t,e,r){var n,p,u=Math.min(t.t,this.t);for(n=0;n<u;++n)r[n]=e(this[n],t[n]);if(t.t<this.t){for(p=t.s&this.DM,n=u;n<this.t;++n)r[n]=e(this[n],p);r.t=this.t}else{for(p=this.s&this.DM,n=u;n<t.t;++n)r[n]=e(p,t[n]);r.t=t.t}r.s=e(this.s,t.s),r.clamp()}function Ge(t,e){return t&e}function ze(t){var e=l();return this.bitwiseTo(t,Ge,e),e}function dt(t,e){return t|e}function Ze(t){var e=l();return this.bitwiseTo(t,dt,e),e}function It(t,e){return t^e}function Ue(t){var e=l();return this.bitwiseTo(t,It,e),e}function kt(t,e){return t&~e}function He(t){var e=l();return this.bitwiseTo(t,kt,e),e}function Ke(){for(var t=l(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t}function We(t){var e=l();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function Je(t){var e=l();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function Qe(t){if(t==0)return-1;var e=0;return t&65535||(t>>=16,e+=16),t&255||(t>>=8,e+=8),t&15||(t>>=4,e+=4),t&3||(t>>=2,e+=2),t&1||++e,e}function Ye(){for(var t=0;t<this.t;++t)if(this[t]!=0)return t*this.DB+Qe(this[t]);return this.s<0?this.t*this.DB:-1}function Xe(t){for(var e=0;t!=0;)t&=t-1,++e;return e}function ts(){for(var t=0,e=this.s&this.DM,r=0;r<this.t;++r)t+=Xe(this[r]^e);return t}function es(t){var e=Math.floor(t/this.DB);return e>=this.t?this.s!=0:(this[e]&1<<t%this.DB)!=0}function ss(t,e){var r=o.ONE.shiftLeft(t);return this.bitwiseTo(r,e,r),r}function rs(t){return this.changeBit(t,dt)}function is(t){return this.changeBit(t,kt)}function ns(t){return this.changeBit(t,It)}function os(t,e){for(var r=0,n=0,p=Math.min(t.t,this.t);r<p;)n+=this[r]+t[r],e[r++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;r<this.t;)n+=this[r],e[r++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;r<t.t;)n+=t[r],e[r++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=n<0?-1:0,n>0?e[r++]=n:n<-1&&(e[r++]=this.DV+n),e.t=r,e.clamp()}function as(t){var e=l();return this.addTo(t,e),e}function hs(t){var e=l();return this.subTo(t,e),e}function cs(t){var e=l();return this.multiplyTo(t,e),e}function ps(){var t=l();return this.squareTo(t),t}function us(t){var e=l();return this.divRemTo(t,e,null),e}function ls(t){var e=l();return this.divRemTo(t,null,e),e}function fs(t){var e=l(),r=l();return this.divRemTo(t,e,r),new Array(e,r)}function ds(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function ms(t,e){if(t!=0){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}}function st(){}function xt(t){return t}function gs(t,e,r){t.multiplyTo(e,r)}function vs(t,e){t.squareTo(e)}st.prototype.convert=xt,st.prototype.revert=xt,st.prototype.mulTo=gs,st.prototype.sqrTo=vs;function ys(t){return this.exp(t,new st)}function bs(t,e,r){var n=Math.min(this.t+t.t,e);for(r.s=0,r.t=n;n>0;)r[--n]=0;var p;for(p=r.t-this.t;n<p;++n)r[n+this.t]=this.am(0,t[n],r,n,0,this.t);for(p=Math.min(t.t,e);n<p;++n)this.am(0,t[n],r,n,0,e-n);r.clamp()}function ws(t,e,r){--e;var n=r.t=this.t+t.t-e;for(r.s=0;--n>=0;)r[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)r[this.t+n-e]=this.am(e-n,t[n],r,0,0,this.t+n-e);r.clamp(),r.drShiftTo(1,r)}function Q(t){this.r2=l(),this.q3=l(),o.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function Ts(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=l();return t.copyTo(e),this.reduce(e),e}function Ss(t){return t}function As(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)}function Bs(t,e){t.squareTo(e),this.reduce(e)}function Ms(t,e,r){t.multiplyTo(e,r),this.reduce(r)}Q.prototype.convert=Ts,Q.prototype.revert=Ss,Q.prototype.reduce=As,Q.prototype.mulTo=Ms,Q.prototype.sqrTo=Bs;function Es(t,e){var r=t.bitLength(),n,p=_(1),u;if(r<=0)return p;r<18?n=1:r<48?n=3:r<144?n=4:r<768?n=5:n=6,r<8?u=new W(e):e.isEven()?u=new Q(e):u=new J(e);var d=new Array,m=3,B=n-1,D=(1<<n)-1;if(d[1]=u.convert(this),n>1){var j=l();for(u.sqrTo(d[1],j);m<=D;)d[m]=l(),u.mulTo(j,d[m-2],d[m]),m+=2}var O=t.t-1,Z,at=!0,F=l(),V;for(r=nt(t[O])-1;O>=0;){for(r>=B?Z=t[O]>>r-B&D:(Z=(t[O]&(1<<r+1)-1)<<B-r,O>0&&(Z|=t[O-1]>>this.DB+r-B)),m=n;!(Z&1);)Z>>=1,--m;if((r-=m)<0&&(r+=this.DB,--O),at)d[Z].copyTo(p),at=!1;else{for(;m>1;)u.sqrTo(p,F),u.sqrTo(F,p),m-=2;m>0?u.sqrTo(p,F):(V=p,p=F,F=V),u.mulTo(F,d[Z],p)}for(;O>=0&&!(t[O]&1<<r);)u.sqrTo(p,F),V=p,p=F,F=V,--r<0&&(r=this.DB-1,--O)}return u.revert(p)}function Is(t){var e=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(e.compareTo(r)<0){var n=e;e=r,r=n}var p=e.getLowestSetBit(),u=r.getLowestSetBit();if(u<0)return e;for(p<u&&(u=p),u>0&&(e.rShiftTo(u,e),r.rShiftTo(u,r));e.signum()>0;)(p=e.getLowestSetBit())>0&&e.rShiftTo(p,e),(p=r.getLowestSetBit())>0&&r.rShiftTo(p,r),e.compareTo(r)>=0?(e.subTo(r,e),e.rShiftTo(1,e)):(r.subTo(e,r),r.rShiftTo(1,r));return u>0&&r.lShiftTo(u,r),r}function ks(t){if(t<=0)return 0;var e=this.DV%t,r=this.s<0?t-1:0;if(this.t>0)if(e==0)r=this[0]%t;else for(var n=this.t-1;n>=0;--n)r=(e*r+this[n])%t;return r}function xs(t){var e=t.isEven();if(this.isEven()&&e||t.signum()==0)return o.ZERO;for(var r=t.clone(),n=this.clone(),p=_(1),u=_(0),d=_(0),m=_(1);r.signum()!=0;){for(;r.isEven();)r.rShiftTo(1,r),e?((!p.isEven()||!u.isEven())&&(p.addTo(this,p),u.subTo(t,u)),p.rShiftTo(1,p)):u.isEven()||u.subTo(t,u),u.rShiftTo(1,u);for(;n.isEven();)n.rShiftTo(1,n),e?((!d.isEven()||!m.isEven())&&(d.addTo(this,d),m.subTo(t,m)),d.rShiftTo(1,d)):m.isEven()||m.subTo(t,m),m.rShiftTo(1,m);r.compareTo(n)>=0?(r.subTo(n,r),e&&p.subTo(d,p),u.subTo(m,u)):(n.subTo(r,n),e&&d.subTo(p,d),m.subTo(u,m))}if(n.compareTo(o.ONE)!=0)return o.ZERO;if(m.compareTo(t)>=0)return m.subtract(t);if(m.signum()<0)m.addTo(t,m);else return m;return m.signum()<0?m.add(t):m}var $=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],Ds=(1<<26)/$[$.length-1];function Rs(t){var e,r=this.abs();if(r.t==1&&r[0]<=$[$.length-1]){for(e=0;e<$.length;++e)if(r[0]==$[e])return!0;return!1}if(r.isEven())return!1;for(e=1;e<$.length;){for(var n=$[e],p=e+1;p<$.length&&n<Ds;)n*=$[p++];for(n=r.modInt(n);e<p;)if(n%$[e++]==0)return!1}return r.millerRabin(t)}function _s(t){var e=this.subtract(o.ONE),r=e.getLowestSetBit();if(r<=0)return!1;var n=e.shiftRight(r);t=t+1>>1,t>$.length&&(t=$.length);for(var p=l(),u=0;u<t;++u){p.fromInt($[Math.floor(Math.random()*$.length)]);var d=p.modPow(n,this);if(d.compareTo(o.ONE)!=0&&d.compareTo(e)!=0){for(var m=1;m++<r&&d.compareTo(e)!=0;)if(d=d.modPowInt(2,this),d.compareTo(o.ONE)==0)return!1;if(d.compareTo(e)!=0)return!1}}return!0}o.prototype.chunkSize=$e,o.prototype.toRadix=Oe,o.prototype.fromRadix=Pe,o.prototype.fromNumber=Le,o.prototype.bitwiseTo=qe,o.prototype.changeBit=ss,o.prototype.addTo=os,o.prototype.dMultiply=ds,o.prototype.dAddOffset=ms,o.prototype.multiplyLowerTo=bs,o.prototype.multiplyUpperTo=ws,o.prototype.modInt=ks,o.prototype.millerRabin=_s,o.prototype.clone=xe,o.prototype.intValue=De,o.prototype.byteValue=Re,o.prototype.shortValue=_e,o.prototype.signum=Ce,o.prototype.toByteArray=je,o.prototype.equals=Ne,o.prototype.min=Fe,o.prototype.max=Ve,o.prototype.and=ze,o.prototype.or=Ze,o.prototype.xor=Ue,o.prototype.andNot=He,o.prototype.not=Ke,o.prototype.shiftLeft=We,o.prototype.shiftRight=Je,o.prototype.getLowestSetBit=Ye,o.prototype.bitCount=ts,o.prototype.testBit=es,o.prototype.setBit=rs,o.prototype.clearBit=is,o.prototype.flipBit=ns,o.prototype.add=as,o.prototype.subtract=hs,o.prototype.multiply=cs,o.prototype.divide=us,o.prototype.remainder=ls,o.prototype.divideAndRemainder=fs,o.prototype.modPow=Es,o.prototype.modInverse=xs,o.prototype.pow=ys,o.prototype.gcd=Is,o.prototype.isProbablePrime=Rs,o.prototype.square=ps,o.prototype.Barrett=Q;var ot,C,x;function $s(t){C[x++]^=t&255,C[x++]^=t>>8&255,C[x++]^=t>>16&255,C[x++]^=t>>24&255,x>=gt&&(x-=gt)}function Dt(){$s(new Date().getTime())}if(C==null){C=new Array,x=0;var N;if(typeof window<"u"&&window.crypto){if(window.crypto.getRandomValues){var Rt=new Uint8Array(32);for(window.crypto.getRandomValues(Rt),N=0;N<32;++N)C[x++]=Rt[N]}else if(navigator.appName=="Netscape"&&navigator.appVersion<"5"){var _t=window.crypto.random(32);for(N=0;N<_t.length;++N)C[x++]=_t.charCodeAt(N)&255}}for(;x<gt;)N=Math.floor(65536*Math.random()),C[x++]=N>>>8,C[x++]=N&255;x=0,Dt()}function Cs(){if(ot==null){for(Dt(),ot=js(),ot.init(C),x=0;x<C.length;++x)C[x]=0;x=0}return ot.next()}function Os(t){var e;for(e=0;e<t.length;++e)t[e]=Cs()}function $t(){}$t.prototype.nextBytes=Os;function mt(){this.i=0,this.j=0,this.S=new Array}function Ps(t){var e,r,n;for(e=0;e<256;++e)this.S[e]=e;for(r=0,e=0;e<256;++e)r=r+this.S[e]+t[e%t.length]&255,n=this.S[e],this.S[e]=this.S[r],this.S[r]=n;this.i=0,this.j=0}function Ls(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]}mt.prototype.init=Ps,mt.prototype.next=Ls;function js(){return new mt}var gt=256;a.exports={default:o,BigInteger:o,SecureRandom:$t}}).call(Ns)})(Jt);var E=Jt.exports,S={};(function(a){(function(){var s={not_string:/[^s]/,not_bool:/[^t]/,not_type:/[^T]/,not_primitive:/[^v]/,number:/[diefg]/,numeric_arg:/[bcdiefguxX]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijostTuvxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[+-]/};function i(v){return c(l(v),arguments)}function h(v,y){return i.apply(null,[v].concat(y||[]))}function c(v,y){var b=1,I=v.length,f,A="",T,w,g,L,M,z,et,_;for(T=0;T<I;T++)if(typeof v[T]=="string")A+=v[T];else if(typeof v[T]=="object"){if(g=v[T],g.keys)for(f=y[b],w=0;w<g.keys.length;w++){if(f==null)throw new Error(i('[sprintf] Cannot access property "%s" of undefined value "%s"',g.keys[w],g.keys[w-1]));f=f[g.keys[w]]}else g.param_no?f=y[g.param_no]:f=y[b++];if(s.not_type.test(g.type)&&s.not_primitive.test(g.type)&&f instanceof Function&&(f=f()),s.numeric_arg.test(g.type)&&typeof f!="number"&&isNaN(f))throw new TypeError(i("[sprintf] expecting number but found %T",f));switch(s.number.test(g.type)&&(et=f>=0),g.type){case"b":f=parseInt(f,10).toString(2);break;case"c":f=String.fromCharCode(parseInt(f,10));break;case"d":case"i":f=parseInt(f,10);break;case"j":f=JSON.stringify(f,null,g.width?parseInt(g.width):0);break;case"e":f=g.precision?parseFloat(f).toExponential(g.precision):parseFloat(f).toExponential();break;case"f":f=g.precision?parseFloat(f).toFixed(g.precision):parseFloat(f);break;case"g":f=g.precision?String(Number(f.toPrecision(g.precision))):parseFloat(f);break;case"o":f=(parseInt(f,10)>>>0).toString(8);break;case"s":f=String(f),f=g.precision?f.substring(0,g.precision):f;break;case"t":f=String(!!f),f=g.precision?f.substring(0,g.precision):f;break;case"T":f=Object.prototype.toString.call(f).slice(8,-1).toLowerCase(),f=g.precision?f.substring(0,g.precision):f;break;case"u":f=parseInt(f,10)>>>0;break;case"v":f=f.valueOf(),f=g.precision?f.substring(0,g.precision):f;break;case"x":f=(parseInt(f,10)>>>0).toString(16);break;case"X":f=(parseInt(f,10)>>>0).toString(16).toUpperCase();break}s.json.test(g.type)?A+=f:(s.number.test(g.type)&&(!et||g.sign)?(_=et?"+":"-",f=f.toString().replace(s.sign,"")):_="",M=g.pad_char?g.pad_char==="0"?"0":g.pad_char.charAt(1):" ",z=g.width-(_+f).length,L=g.width&&z>0?M.repeat(z):"",A+=g.align?_+f+L:M==="0"?_+L+f:L+_+f)}return A}var o=Object.create(null);function l(v){if(o[v])return o[v];for(var y=v,b,I=[],f=0;y;){if((b=s.text.exec(y))!==null)I.push(b[0]);else if((b=s.modulo.exec(y))!==null)I.push("%");else if((b=s.placeholder.exec(y))!==null){if(b[2]){f|=1;var A=[],T=b[2],w=[];if((w=s.key.exec(T))!==null)for(A.push(w[1]);(T=T.substring(w[0].length))!=="";)if((w=s.key_access.exec(T))!==null)A.push(w[1]);else if((w=s.index_access.exec(T))!==null)A.push(w[1]);else throw new SyntaxError("[sprintf] failed to parse named argument key");else throw new SyntaxError("[sprintf] failed to parse named argument key");b[2]=A}else f|=2;if(f===3)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");I.push({placeholder:b[0],param_no:b[1],keys:b[2],sign:b[3],pad_char:b[4],align:b[5],width:b[6],precision:b[7],type:b[8]})}else throw new SyntaxError("[sprintf] unexpected placeholder");y=y.substring(b[0].length)}return o[v]=I}a.sprintf=i,a.vsprintf=h,typeof window<"u"&&(window.sprintf=i,window.vsprintf=h)})()})(S);class k{constructor(s){this.groups=Ct,this.parsedAddress=[],this.parsedSubnet="",this.subnet="/32",this.subnetMask=32,this.v4=!0,this.isCorrect=Wt(X),this.isInSubnet=Kt,this.address=s;const i=Ot.exec(s);if(i){if(this.parsedSubnet=i[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet=`/${this.subnetMask}`,this.subnetMask<0||this.subnetMask>X)throw new G("Invalid subnet mask.");s=s.replace(Ot,"")}this.addressMinusSuffix=s,this.parsedAddress=this.parse(s)}static isValid(s){try{return new k(s),!0}catch{return!1}}parse(s){const i=s.split(".");if(!s.match(lt))throw new G("Invalid IPv4 address.");return i}correctForm(){return this.parsedAddress.map(s=>parseInt(s,10)).join(".")}static fromHex(s){const i=s.replace(/:/g,"").padStart(8,"0"),h=[];let c;for(c=0;c<8;c+=2){const o=i.slice(c,c+2);h.push(parseInt(o,16))}return new k(h.join("."))}static fromInteger(s){return k.fromHex(s.toString(16))}static fromArpa(s){const i=s.replace(/(\.in-addr\.arpa)?\.$/,"").split(".").reverse().join(".");return new k(i)}toHex(){return this.parsedAddress.map(s=>S.sprintf("%02x",parseInt(s,10))).join(":")}toArray(){return this.parsedAddress.map(s=>parseInt(s,10))}toGroup6(){const s=[];let i;for(i=0;i<Ct;i+=2){const h=S.sprintf("%02x%02x",parseInt(this.parsedAddress[i],10),parseInt(this.parsedAddress[i+1],10));s.push(S.sprintf("%x",parseInt(h,16)))}return s.join(":")}bigInteger(){return new E.BigInteger(this.parsedAddress.map(s=>S.sprintf("%02x",parseInt(s,10))).join(""),16)}_startAddress(){return new E.BigInteger(this.mask()+"0".repeat(X-this.subnetMask),2)}startAddress(){return k.fromBigInteger(this._startAddress())}startAddressExclusive(){const s=new E.BigInteger("1");return k.fromBigInteger(this._startAddress().add(s))}_endAddress(){return new E.BigInteger(this.mask()+"1".repeat(X-this.subnetMask),2)}endAddress(){return k.fromBigInteger(this._endAddress())}endAddressExclusive(){const s=new E.BigInteger("1");return k.fromBigInteger(this._endAddress().subtract(s))}static fromBigInteger(s){return k.fromInteger(parseInt(s.toString(),10))}mask(s){return s===void 0&&(s=this.subnetMask),this.getBitsBase2(0,s)}getBitsBase2(s,i){return this.binaryZeroPad().slice(s,i)}reverseForm(s){s||(s={});const i=this.correctForm().split(".").reverse().join(".");return s.omitSuffix?i:S.sprintf("%s.in-addr.arpa.",i)}isMulticast(){return this.isInSubnet(new k("224.0.0.0/4"))}binaryZeroPad(){return this.bigInteger().toString(2).padStart(X,"0")}groupForV6(){const s=this.parsedAddress;return this.address.replace(lt,S.sprintf('<span class="hover-group group-v4 group-6">%s</span>.<span class="hover-group group-v4 group-7">%s</span>',s.slice(0,2).join("."),s.slice(2,4).join(".")))}}const U=128,rt=8,Ys={0:"Reserved",1:"Interface local",2:"Link local",4:"Admin local",5:"Site local",8:"Organization local",14:"Global",15:"Reserved"},Pt={"ff01::1/128":"Multicast (All nodes on this interface)","ff01::2/128":"Multicast (All routers on this interface)","ff02::1/128":"Multicast (All nodes on this link)","ff02::2/128":"Multicast (All routers on this link)","ff05::2/128":"Multicast (All routers in this site)","ff02::5/128":"Multicast (OSPFv3 AllSPF routers)","ff02::6/128":"Multicast (OSPFv3 AllDR routers)","ff02::9/128":"Multicast (RIP routers)","ff02::a/128":"Multicast (EIGRP routers)","ff02::d/128":"Multicast (PIM routers)","ff02::16/128":"Multicast (MLDv2 reports)","ff01::fb/128":"Multicast (mDNSv6)","ff02::fb/128":"Multicast (mDNSv6)","ff05::fb/128":"Multicast (mDNSv6)","ff02::1:2/128":"Multicast (All DHCP servers and relay agents on this link)","ff05::1:2/128":"Multicast (All DHCP servers and relay agents in this site)","ff02::1:3/128":"Multicast (All DHCP servers on this link)","ff05::1:3/128":"Multicast (All DHCP servers in this site)","::/128":"Unspecified","::1/128":"Loopback","ff00::/8":"Multicast","fe80::/10":"Link-local unicast"},Lt=/([^0-9a-f:/%])/gi,jt=/([0-9a-f]{5,}|:{3,}|[^:]:$|^:[^:]|\/$)/gi,Nt=/\/\d{1,3}(?=%|$)/,Ft=/%.*$/,Xs=new RegExp(/^\[{0,1}([0-9a-f:]+)\]{0,1}/),tr=new RegExp(/\[([0-9a-f:]+)\]:([0-9]{1,5})/);function er(a){return a.replace(/^(0+)/,'<span class="zero">$1</span>')}function bt(a,s=0){return a.split(":").map((i,h)=>/group-v4/.test(i)?i:S.sprintf('<span class="hover-group group-%d">%s</span>',h+s,er(i)))}function Bt(a){return S.sprintf("(%s)",a.join("|"))}function wt(a){return a.length<4?S.sprintf("0{0,%d}%s",4-a.length,a):a}const Vt="[^A-Fa-f0-9:]";function Tt(a){const s=[];a.forEach((h,c)=>{parseInt(h,16)===0&&s.push(c)});const i=s.map(h=>a.map((c,o)=>{if(o===h){const l=o===0||o===rt-1?":":"";return Bt([wt(c),l])}return wt(c)}).join(":"));return i.push(a.map(wt).join(":")),Bt(i)}function qt(a,s,i){const h=s?"":":",c=i?"":":",o=[];!s&&!i&&o.push("::"),s&&i&&o.push(""),(i&&!s||!i&&s)&&o.push(":"),o.push(S.sprintf("%s(:0{1,4}){1,%d}",h,a-1)),o.push(S.sprintf("(0{1,4}:){1,%d}%s",a-1,c)),o.push(S.sprintf("(0{1,4}:){%d}0{1,4}",a-1));for(let l=1;l<a-1;l++)for(let v=1;v<a-l;v++)o.push(S.sprintf("(0{1,4}:){%d}:(0{1,4}:){%d}0{1,4}",v,a-v-l-1));return Bt(o)}function pt(a){if(!a)throw new Error("Assertion failed.")}function sr(a){const s=/(\d+)(\d{3})/;for(;s.test(a);)a=a.replace(s,"$1,$2");return a}function rr(a){return a=a.replace(/^(0{1,})([1-9]+)$/,'<span class="parse-error">$1</span>$2'),a=a.replace(/^(0{1,})(0)$/,'<span class="parse-error">$1</span>$2'),a}function ir(a,s){const i=[],h=[];let c;for(c=0;c<a.length;c++)c<s[0]?i.push(a[c]):c>s[1]&&h.push(a[c]);return i.concat(["compact"]).concat(h)}function Gt(a){return S.sprintf("%04x",parseInt(a,16))}function zt(a){return a&255}class R{constructor(s,i){this.addressMinusSuffix="",this.parsedSubnet="",this.subnet="/128",this.subnetMask=128,this.v4=!1,this.zone="",this.isInSubnet=Kt,this.isCorrect=Wt(U),i===void 0?this.groups=rt:this.groups=i,this.address=s;const h=Nt.exec(s);if(h){if(this.parsedSubnet=h[0].replace("/",""),this.subnetMask=parseInt(this.parsedSubnet,10),this.subnet=`/${this.subnetMask}`,Number.isNaN(this.subnetMask)||this.subnetMask<0||this.subnetMask>U)throw new G("Invalid subnet mask.");s=s.replace(Nt,"")}else if(/\//.test(s))throw new G("Invalid subnet mask.");const c=Ft.exec(s);c&&(this.zone=c[0],s=s.replace(Ft,"")),this.addressMinusSuffix=s,this.parsedAddress=this.parse(this.addressMinusSuffix)}static isValid(s){try{return new R(s),!0}catch{return!1}}static fromBigInteger(s){const i=s.toString(16).padStart(32,"0"),h=[];let c;for(c=0;c<rt;c++)h.push(i.slice(c*4,(c+1)*4));return new R(h.join(":"))}static fromURL(s){let i,h=null,c;if(s.indexOf("[")!==-1&&s.indexOf("]:")!==-1){if(c=tr.exec(s),c===null)return{error:"failed to parse address with port",address:null,port:null};i=c[1],h=c[2]}else if(s.indexOf("/")!==-1){if(s=s.replace(/^[a-z0-9]+:\/\//,""),c=Xs.exec(s),c===null)return{error:"failed to parse address from URL",address:null,port:null};i=c[1]}else i=s;return h?(h=parseInt(h,10),(h<0||h>65536)&&(h=null)):h=null,{address:new R(i),port:h}}static fromAddress4(s){const i=new k(s),h=U-(X-i.subnetMask);return new R(`::ffff:${i.correctForm()}/${h}`)}static fromArpa(s){let i=s.replace(/(\.ip6\.arpa)?\.$/,"");const h=7;if(i.length!==63)throw new G("Invalid 'ip6.arpa' form.");const c=i.split(".").reverse();for(let o=h;o>0;o--){const l=o*4;c.splice(l,0,":")}return i=c.join(""),new R(i)}microsoftTranscription(){return S.sprintf("%s.ipv6-literal.net",this.correctForm().replace(/:/g,"-"))}mask(s=this.subnetMask){return this.getBitsBase2(0,s)}possibleSubnets(s=128){const i=U-this.subnetMask,h=Math.abs(s-U),c=i-h;return c<0?"0":sr(new E.BigInteger("2",10).pow(c).toString(10))}_startAddress(){return new E.BigInteger(this.mask()+"0".repeat(U-this.subnetMask),2)}startAddress(){return R.fromBigInteger(this._startAddress())}startAddressExclusive(){const s=new E.BigInteger("1");return R.fromBigInteger(this._startAddress().add(s))}_endAddress(){return new E.BigInteger(this.mask()+"1".repeat(U-this.subnetMask),2)}endAddress(){return R.fromBigInteger(this._endAddress())}endAddressExclusive(){const s=new E.BigInteger("1");return R.fromBigInteger(this._endAddress().subtract(s))}getScope(){let s=Ys[this.getBits(12,16).intValue()];return this.getType()==="Global unicast"&&s!=="Link local"&&(s="Global"),s||"Unknown"}getType(){for(const s of Object.keys(Pt))if(this.isInSubnet(new R(s)))return Pt[s];return"Global unicast"}getBits(s,i){return new E.BigInteger(this.getBitsBase2(s,i),2)}getBitsBase2(s,i){return this.binaryZeroPad().slice(s,i)}getBitsBase16(s,i){const h=i-s;if(h%4!==0)throw new Error("Length of bits to retrieve must be divisible by four");return this.getBits(s,i).toString(16).padStart(h/4,"0")}getBitsPastSubnet(){return this.getBitsBase2(this.subnetMask,U)}reverseForm(s){s||(s={});const i=Math.floor(this.subnetMask/4),h=this.canonicalForm().replace(/:/g,"").split("").slice(0,i).reverse().join(".");return i>0?s.omitSuffix?h:S.sprintf("%s.ip6.arpa.",h):s.omitSuffix?"":"ip6.arpa."}correctForm(){let s,i=[],h=0;const c=[];for(s=0;s<this.parsedAddress.length;s++){const v=parseInt(this.parsedAddress[s],16);v===0&&h++,v!==0&&h>0&&(h>1&&c.push([s-h,s-1]),h=0)}h>1&&c.push([this.parsedAddress.length-h,this.parsedAddress.length-1]);const o=c.map(v=>v[1]-v[0]+1);if(c.length>0){const v=o.indexOf(Math.max(...o));i=ir(this.parsedAddress,c[v])}else i=this.parsedAddress;for(s=0;s<i.length;s++)i[s]!=="compact"&&(i[s]=parseInt(i[s],16).toString(16));let l=i.join(":");return l=l.replace(/^compact$/,"::"),l=l.replace(/^compact|compact$/,":"),l=l.replace(/compact/,""),l}binaryZeroPad(){return this.bigInteger().toString(2).padStart(U,"0")}parse4in6(s){const i=s.split(":"),h=i.slice(-1)[0].match(lt);if(h){this.parsedAddress4=h[0],this.address4=new k(this.parsedAddress4);for(let c=0;c<this.address4.groups;c++)if(/^0[0-9]+/.test(this.address4.parsedAddress[c]))throw new G("IPv4 addresses can't have leading zeroes.",s.replace(lt,this.address4.parsedAddress.map(rr).join(".")));this.v4=!0,i[i.length-1]=this.address4.toGroup6(),s=i.join(":")}return s}parse(s){s=this.parse4in6(s);const i=s.match(Lt);if(i)throw new G(S.sprintf("Bad character%s detected in address: %s",i.length>1?"s":"",i.join("")),s.replace(Lt,'<span class="parse-error">$1</span>'));const h=s.match(jt);if(h)throw new G(S.sprintf("Address failed regex: %s",h.join("")),s.replace(jt,'<span class="parse-error">$1</span>'));let c=[];const o=s.split("::");if(o.length===2){let l=o[0].split(":"),v=o[1].split(":");l.length===1&&l[0]===""&&(l=[]),v.length===1&&v[0]===""&&(v=[]);const y=this.groups-(l.length+v.length);if(!y)throw new G("Error parsing groups");this.elidedGroups=y,this.elisionBegin=l.length,this.elisionEnd=l.length+this.elidedGroups,c=c.concat(l);for(let b=0;b<y;b++)c.push("0");c=c.concat(v)}else if(o.length===1)c=s.split(":"),this.elidedGroups=0;else throw new G("Too many :: groups found");if(c=c.map(l=>S.sprintf("%x",parseInt(l,16))),c.length!==this.groups)throw new G("Incorrect number of groups found");return c}canonicalForm(){return this.parsedAddress.map(Gt).join(":")}decimal(){return this.parsedAddress.map(s=>S.sprintf("%05d",parseInt(s,16))).join(":")}bigInteger(){return new E.BigInteger(this.parsedAddress.map(Gt).join(""),16)}to4(){const s=this.binaryZeroPad().split("");return k.fromHex(new E.BigInteger(s.slice(96,128).join(""),2).toString(16))}to4in6(){const s=this.to4(),i=new R(this.parsedAddress.slice(0,6).join(":"),6).correctForm();let h="";return/:$/.test(i)||(h=":"),i+h+s.address}inspectTeredo(){const s=this.getBitsBase16(0,32),i=this.getBits(80,96).xor(new E.BigInteger("ffff",16)).toString(),h=k.fromHex(this.getBitsBase16(32,64)),c=k.fromHex(this.getBits(96,128).xor(new E.BigInteger("ffffffff",16)).toString(16)),o=this.getBits(64,80),l=this.getBitsBase2(64,80),v=o.testBit(15),y=o.testBit(14),b=o.testBit(8),I=o.testBit(9),f=new E.BigInteger(l.slice(2,6)+l.slice(8,16),2).toString(10);return{prefix:S.sprintf("%s:%s",s.slice(0,4),s.slice(4,8)),server4:h.address,client4:c.address,flags:l,coneNat:v,microsoft:{reserved:y,universalLocal:I,groupIndividual:b,nonce:f},udpPort:i}}inspect6to4(){const s=this.getBitsBase16(0,16),i=k.fromHex(this.getBitsBase16(16,48));return{prefix:S.sprintf("%s",s.slice(0,4)),gateway:i.address}}to6to4(){if(!this.is4())return null;const s=["2002",this.getBitsBase16(96,112),this.getBitsBase16(112,128),"","/16"].join(":");return new R(s)}toByteArray(){const s=this.bigInteger().toByteArray();return s.length===17&&s[0]===0?s.slice(1):s}toUnsignedByteArray(){return this.toByteArray().map(zt)}static fromByteArray(s){return this.fromUnsignedByteArray(s.map(zt))}static fromUnsignedByteArray(s){const i=new E.BigInteger("256",10);let h=new E.BigInteger("0",10),c=new E.BigInteger("1",10);for(let o=s.length-1;o>=0;o--)h=h.add(c.multiply(new E.BigInteger(s[o].toString(10),10))),c=c.multiply(i);return R.fromBigInteger(h)}isCanonical(){return this.addressMinusSuffix===this.canonicalForm()}isLinkLocal(){return this.getBitsBase2(0,64)==="1111111010000000000000000000000000000000000000000000000000000000"}isMulticast(){return this.getType()==="Multicast"}is4(){return this.v4}isTeredo(){return this.isInSubnet(new R("2001::/32"))}is6to4(){return this.isInSubnet(new R("2002::/16"))}isLoopback(){return this.getType()==="Loopback"}href(s){return s===void 0?s="":s=S.sprintf(":%s",s),S.sprintf("http://[%s]%s/",this.correctForm(),s)}link(s){s||(s={}),s.className===void 0&&(s.className=""),s.prefix===void 0&&(s.prefix="/#address="),s.v4===void 0&&(s.v4=!1);let i=this.correctForm;return s.v4&&(i=this.to4in6),s.className?S.sprintf('<a href="%1$s%2$s" class="%3$s">%2$s</a>',s.prefix,i.call(this),s.className):S.sprintf('<a href="%1$s%2$s">%2$s</a>',s.prefix,i.call(this))}group(){if(this.elidedGroups===0)return bt(this.address).join(":");pt(typeof this.elidedGroups=="number"),pt(typeof this.elisionBegin=="number");const s=[],[i,h]=this.address.split("::");i.length?s.push(...bt(i)):s.push("");const c=["hover-group"];for(let o=this.elisionBegin;o<this.elisionBegin+this.elidedGroups;o++)c.push(S.sprintf("group-%d",o));return s.push(S.sprintf('<span class="%s"></span>',c.join(" "))),h.length?s.push(...bt(h,this.elisionEnd)):s.push(""),this.is4()&&(pt(this.address4 instanceof k),s.pop(),s.push(this.address4.groupForV6())),s.join(":")}regularExpressionString(s=!1){let i=[];const h=new R(this.correctForm());if(h.elidedGroups===0)i.push(Tt(h.parsedAddress));else if(h.elidedGroups===rt)i.push(qt(rt));else{const c=h.address.split("::");c[0].length&&i.push(Tt(c[0].split(":"))),pt(typeof h.elidedGroups=="number"),i.push(qt(h.elidedGroups,c[0].length!==0,c[1].length!==0)),c[1].length&&i.push(Tt(c[1].split(":"))),i=[i.join(":")]}return s||(i=["(?=^|",Vt,"|[^\\w\\:])(",...i,")(?=[^\\w\\:]|",Vt,"|$)"]),i.join("")}regularExpression(s=!1){return new RegExp(this.regularExpressionString(s),"i")}}const nr=ft("libp2p:ip-port-to-multiaddr"),St={ERR_INVALID_IP_PARAMETER:"ERR_INVALID_IP_PARAMETER",ERR_INVALID_PORT_PARAMETER:"ERR_INVALID_PORT_PARAMETER",ERR_INVALID_IP:"ERR_INVALID_IP"};function or(a,s){if(typeof a!="string")throw new Y(`invalid ip provided: ${a}`,St.ERR_INVALID_IP_PARAMETER);if(typeof s=="string"&&(s=parseInt(s)),isNaN(s))throw new Y(`invalid port provided: ${s}`,St.ERR_INVALID_PORT_PARAMETER);try{return new k(a),ut(`/ip4/${a}/tcp/${s}`)}catch{}try{const i=new R(a);return i.is4()?ut(`/ip4/${i.to4().correctForm()}/tcp/${s}`):ut(`/ip6/${a}/tcp/${s}`)}catch{const i=`invalid ip:port for creating a multiaddr: ${a}:${s}`;throw nr.error(i),new Y(i,St.ERR_INVALID_IP)}}const Qt=421,ar=290,hr=400,cr=2e3,pr=5*6e4,ur={ip4:"IPv4",ip6:"IPv6"};function Et(a,s={}){const i=a.getPath();return i!=null?it.platform()==="win32"?{path:it.join("\\\\.\\pipe\\",i)}:{path:i}:{...a.toOptions(),...s}}function Zt(a,s,i){const h=c=>ut(`/${a}/${c}/tcp/${i}`);return(lr(s)?dr(ur[a]):[s]).map(h)}function lr(a){return["0.0.0.0","::"].includes(a)}const fr=it.networkInterfaces();function dr(a){const s=[];for(const[,i]of Object.entries(fr))if(i!=null)for(const h of i)h.family===a&&s.push(h.address);return s}const q=ft("libp2p:tcp:socket"),Yt=(a,s)=>{const i=s.metrics,h=s.metricPrefix??"",c=s.socketInactivityTimeout??pr,o=s.socketCloseTimeout??cr;s.listeningAddr?.getPath()!=null&&(s.remoteAddr=s.listeningAddr),s.remoteAddr?.getPath()!=null&&(s.localAddr=s.remoteAddr);let l;if(s.remoteAddr!=null)l=s.remoteAddr;else{if(a.remoteAddress==null||a.remotePort==null)throw new Y("Could not determine remote address or port","ERR_NO_REMOTE_ADDRESS");l=or(a.remoteAddress,a.remotePort)}const v=Et(l),y=v.path??`${v.host??""}:${v.port??""}`,{sink:b,source:I}=Qs.duplex(a);a.setTimeout(c,()=>{q("%s socket read timeout",y),i?.increment({[`${h}timeout`]:!0});let A;a.readable&&(A=new Y("Socket read timeout","ERR_SOCKET_READ_TIMEOUT")),a.destroy(A)}),a.once("close",()=>{q("%s socket close",y),i?.increment({[`${h}close`]:!0}),f.timeline.close==null&&(f.timeline.close=Date.now())}),a.once("end",()=>{q("%s socket end",y),i?.increment({[`${h}end`]:!0})});const f={async sink(A){try{await b(A)}catch(T){T.type!=="aborted"&&q(T)}a.end()},source:I,remoteAddr:l,timeline:{open:Date.now()},async close(){if(a.destroyed){q("%s socket was already destroyed when trying to close",y);return}q("%s closing socket",y),await new Promise((A,T)=>{const w=Date.now();let g;a.once("close",()=>{q("%s socket closed",y),g!==void 0&&clearTimeout(g),A()}),a.once("error",L=>{q("%s socket error",y,L),f.timeline.close==null&&(f.timeline.close=Date.now()),a.destroyed&&g!==void 0&&clearTimeout(g),T(L)}),a.setTimeout(o),a.end(),a.writableLength>0?(g=setTimeout(()=>{a.destroyed?(q("%s is already destroyed",y),A()):(q("%s socket close timeout after %dms, destroying it manually",y,Date.now()-w),a.destroy(new Y("Socket close timeout","ERR_SOCKET_CLOSE_TIMEOUT")))},o).unref(),a.once("drain",()=>{q("%s socket drained",y),a.destroy()})):a.destroy()})}};return f},P=ft("libp2p:tcp:listener");async function At(a){try{await a.close()}catch(s){P.error("an error occurred closing the connection",s)}}const mr=1,gr=0;class vr extends qs{constructor(s){if(super(),this.context=s,this.connections=new Set,this.status={started:!1},s.keepAlive=s.keepAlive??!0,this.addr="unknown",this.server=it.createServer(s,this.onSocket.bind(this)),s.maxConnections!==void 0&&(this.server.maxConnections=s.maxConnections),s.closeServerOnMaxConnections!=null&&s.closeServerOnMaxConnections.closeAbove<s.closeServerOnMaxConnections.listenBelow)throw Error("closeAbove must be >= listenBelow");this.server.on("listening",()=>{if(s.metrics!=null){const i=this.server.address();i==null?this.addr="unknown":typeof i=="string"?this.addr=i:this.addr=`${i.address}:${i.port}`,s.metrics?.registerMetricGroup("libp2p_tcp_inbound_connections_total",{label:"address",help:"Current active connections in TCP listener",calculate:()=>({[this.addr]:this.connections.size})}),this.metrics={status:s.metrics.registerMetricGroup("libp2p_tcp_listener_status_info",{label:"address",help:"Current status of the TCP listener socket"}),errors:s.metrics.registerMetricGroup("libp2p_tcp_listener_errors_total",{label:"address",help:"Total count of TCP listener errors by type"}),events:s.metrics.registerMetricGroup("libp2p_tcp_listener_events_total",{label:"address",help:"Total count of TCP listener events by type"})},this.metrics?.status.update({[this.addr]:mr})}this.dispatchEvent(new ct("listening"))}).on("error",i=>{this.metrics?.errors.increment({[`${this.addr} listen_error`]:!0}),this.dispatchEvent(new ct("error",{detail:i}))}).on("close",()=>{this.metrics?.status.update({[this.addr]:gr}),this.dispatchEvent(new ct("close"))})}onSocket(s){s.on("error",h=>{P("socket error",h),this.metrics?.events.increment({[`${this.addr} error`]:!0})});let i;try{i=Yt(s,{listeningAddr:this.status.started?this.status.listeningAddr:void 0,socketInactivityTimeout:this.context.socketInactivityTimeout,socketCloseTimeout:this.context.socketCloseTimeout,metrics:this.metrics?.events,metricPrefix:`${this.addr} `})}catch(h){P.error("inbound connection failed",h),this.metrics?.errors.increment({[`${this.addr} inbound_to_connection`]:!0});return}P("new inbound connection %s",i.remoteAddr);try{this.context.upgrader.upgradeInbound(i).then(h=>{P("inbound connection upgraded %s",i.remoteAddr),this.connections.add(i),s.once("close",()=>{this.connections.delete(i),this.context.closeServerOnMaxConnections!=null&&this.connections.size<this.context.closeServerOnMaxConnections.listenBelow&&this.netListen().catch(c=>{P.error("error attempting to listen server once connection count under limit",c),this.context.closeServerOnMaxConnections?.onListenError?.(c)})}),this.context.handler!=null&&this.context.handler(h),this.context.closeServerOnMaxConnections!=null&&this.connections.size>=this.context.closeServerOnMaxConnections.closeAbove&&this.netClose(),this.dispatchEvent(new ct("connection",{detail:h}))}).catch(async h=>{P.error("inbound connection failed",h),this.metrics?.errors.increment({[`${this.addr} inbound_upgrade`]:!0}),await At(i)}).catch(h=>{P.error("closing inbound connection failed",h)})}catch(h){P.error("inbound connection failed",h),At(i).catch(c=>{P.error("closing inbound connection failed",c),this.metrics?.errors.increment({[`${this.addr} inbound_closing_failed`]:!0})})}}getAddrs(){if(!this.status.started)return[];let s=[];const i=this.server.address(),{listeningAddr:h,peerId:c}=this.status;if(i==null)return[];if(typeof i=="string")s=[h];else try{h.toString().startsWith("/ip4")?s=s.concat(Zt("ip4",i.address,i.port)):i.family==="IPv6"&&(s=s.concat(Zt("ip6",i.address,i.port)))}catch(o){P.error("could not turn %s:%s into multiaddr",i.address,i.port,o)}return s.map(o=>c!=null?o.encapsulate(`/p2p/${c}`):o)}async listen(s){if(this.status.started)throw Error("server is already listening");const i=s.getPeerId(),h=i==null?s.decapsulateCode(Qt):s,{backlog:c}=this.context;this.status={started:!0,listeningAddr:h,peerId:i,netConfig:Et(h,{backlog:c})},await this.netListen()}async close(){await Promise.all(Array.from(this.connections.values()).map(async s=>{await At(s)})),this.netClose()}async netListen(){if(!this.status.started||this.server.listening)return;const s=this.status.netConfig;await new Promise((i,h)=>{this.server.once("error",h),this.server.listen(s,i)}),P("Listening on %s",this.server.address())}netClose(){!this.status.started||!this.server.listening||(P("Closing server on %s",this.server.address()),this.server.close())}}const H=ft("libp2p:tcp");class yr{constructor(s,i={}){this.opts=i,this.components=s,s.metrics!=null&&(this.metrics={dialerEvents:s.metrics.registerCounterGroup("libp2p_tcp_dialer_events_total",{label:"event",help:"Total count of TCP dialer events by type"})})}get[Fs](){return!0}get[Symbol.toStringTag](){return"@libp2p/tcp"}async dial(s,i){i.keepAlive=i.keepAlive??!0;const h=await this._connect(s,i);h.on("error",v=>{H("socket error",v)});const c=Yt(h,{remoteAddr:s,socketInactivityTimeout:this.opts.outboundSocketInactivityTimeout,socketCloseTimeout:this.opts.socketCloseTimeout,metrics:this.metrics?.dialerEvents}),o=()=>{c.close().catch(v=>{H.error("Error closing maConn after abort",v)})};i.signal?.addEventListener("abort",o,{once:!0}),H("new outbound connection %s",c.remoteAddr);const l=await i.upgrader.upgradeOutbound(c);if(H("outbound connection %s upgraded",c.remoteAddr),i.signal?.removeEventListener("abort",o),i.signal?.aborted===!0)throw l.close().catch(v=>{H.error("Error closing conn after abort",v)}),new yt;return l}async _connect(s,i){if(i.signal?.aborted===!0)throw new yt;return await new Promise((h,c)=>{const o=Date.now(),l=Et(s),v=l.path??`${l.host??""}:${l.port}`;H("dialing %j",l);const y=it.connect(l),b=w=>{w.message=`connection error ${v}: ${w.message}`,this.metrics?.dialerEvents.increment({error:!0}),T(w)},I=()=>{H("connection timeout %s",v),this.metrics?.dialerEvents.increment({timeout:!0});const w=new Y(`connection timeout after ${Date.now()-o}ms`,"ERR_CONNECT_TIMEOUT");y.emit("error",w)},f=()=>{H("connection opened %j",l),this.metrics?.dialerEvents.increment({connect:!0}),T()},A=()=>{H("connection aborted %j",l),this.metrics?.dialerEvents.increment({abort:!0}),y.destroy(),T(new yt)},T=w=>{if(y.removeListener("error",b),y.removeListener("timeout",I),y.removeListener("connect",f),i.signal!=null&&i.signal.removeEventListener("abort",A),w!=null){c(w);return}h(y)};y.on("error",b),y.on("timeout",I),y.on("connect",f),i.signal!=null&&i.signal.addEventListener("abort",A)})}createListener(s){return new vr({...s,maxConnections:this.opts.maxConnections,backlog:this.opts.backlog,closeServerOnMaxConnections:this.opts.closeServerOnMaxConnections,socketInactivityTimeout:this.opts.inboundSocketInactivityTimeout,socketCloseTimeout:this.opts.socketCloseTimeout,metrics:this.components.metrics})}filter(s){return s=Array.isArray(s)?s:[s],s.filter(i=>i.protoCodes().includes(ar)?!1:i.protoCodes().includes(hr)?!0:Vs.matches(i.decapsulateCode(Qt)))}}function wr(a={}){return(s={})=>new yr(s,a)}export{wr as tcp};
